<!DOCTYPE html>
<html lang = 'en-us'>
    <head>
      <meta charset="UTF-8">
      <title>Editor</title>
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
      <script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
      <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css"> -->
      <link rel="stylesheet" type="text/css" href="css/vis.css">
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
      <!-- <script type="text/javascript" src="js/vis.js"></script> -->

      <link rel="stylesheet" type="text/css" href="css/net_editor.css"></head>
    <style>

        .node_clicked {
          border-style: solid;"
        }

        #part1 {
          position: relative;
          width: 40%;
          top: 10%;
          left: 30%;
        }

        #part2 {
          position: relative;
          width: 80%;
          top: 10%;
          left: 10%;
        }

        .caption {
          font-size: 20px;
        }

        #num_friends {
          margin-top: 20px;
        }

        #instr1 {
          margin-top: 30px;
        }

        #submit_second {
          margin-bottom: 20px;
          margin-top: 20px;
        }

    </style>




    <body>
        <div id="part1" class="part">
            <div id="instr1">
                <p id="instr-text" class="text-center"><b>How many friends does this person have?</b></p>
            </div>

            <div id="primary_node_container">
                <img id="primary_node_pic" class="mx-auto d-block img-fluid"/>
                <!-- Add pic using jquery in element through style="background-image: url(http://trovacamporella.com/img/trovacamporella-fiat500.png);" -->
            </div>

            <div id="info-form" class="survey" data-toggle="validator" role="form">
                <form action="javascript:submit1();" class="form-horizontal">
                  <div id="num_friends" class="form-group">
                      <label id="user-id-text" class="control-label" for="user-id">Number of friends</label>
                      <input id="friend_input" type="text" class="form-control input-md" placeholder="Please enter numbers only." autocomplete="off" required>
                  </div>
                  <button id="submit_first" type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>

            <div id="instr2">
                <p id="instr-text" class="text-center"> Please select the friends of the above person. </p>
                <p id="instr-text" class="text-center"> <b> Please revise your original input as necessary. </b></p>
            </div>
        </div>

        <div id="part2">

            <div id="other_nodes" class="container">
                <div id="row1" class="row">
                </div>

                <div id="row2" class="row">
                </div>
            </div>

            <div id="info-form" class="survey" data-toggle="validator" role="form">
                <form action="javascript:submit2();" class="form-horizontal">
                  <button id="submit_second" type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>


        </div>
    </body>


    <script type="text/javascript" src="js/subject_imgs.js"></script>
    <script type="text/javascript">

        $("#part2").hide();
        $("#instr2").hide();

        var userId = '';
        var sid = null, sectionId = null;
        var parameters = window.location.search.substring(1);
        if (parameters.length > 17 && parameters.length < 21) {
            userId = parameters.split(/[&=]/)[1];
            sid = userId.substring(4);
            sectionId = parameters[parameters.length - 1];
        }
        if (userId.length < 5 || userId.length > 8 || !userId.startsWith('ucla') ||
            isNaN(sid) || isNaN(sectionId)) {
            //$('body').empty();
            //return;
        }
        sid = parseInt(sid);

        var iterator = 0;

        var friend_inputs = [];
        var checked_nodes = [];

        var results = [];

        function eval_input(input) {
            if (/^[0-9]+$/.test(input)) {
                return false;
            }
            return true;
        }
        /*
        function get_info(sid, sectionId) {
            console.log("called");
            for (var i = 0; i < subject_imgs[sid][sectionId].length; ++i) {
                node_info.push(["img/"+subject_imgs[sid][sectionId][i][0], subject_imgs[sid][sectionId][i][1]]);
            }

            console.log(node_info);
        }
        */

        function draw() {
            console.log("called")
            $("#row1").empty();
            $("#row2").empty();

            var row;
            $("#primary_node_pic").attr("src", "img/" + subject_imgs[iterator]);

            for (var i = 0; i < subject_imgs.length; ++i) {
                row = i < 6 ? "1":"2";
                console.log(row)
                if (i===iterator) {
                    continue;
                }

                $("#row" + row).append('<div class="col-sm" <div class="button-group-toggle" data-toggle="buttons"><label id="node_button" class="btn btn-circle active node-button" for="node_pic' + i + '"><input id="node_button_check" type="checkbox" name="options" autocomplete="off" active><img id="node_pic' + i + '" src="img/'+ subject_imgs[i] +'" class="mx-auto d-block img-fluid"></label></div></div>');
            }
            attach_listeners();

        }

        function submit1() {
            $('#friend_input').removeClass('is-invalid');
            if (eval_input($("#friend_input").val())) {
                $('#friend_input').addClass('is-invalid');
                console.log('inside');
                return;
            }
            friend_inputs.push($("#friend_input").val())
            $('#submit_first').hide();
            $('#part2').show();
            $('#instr2').show();
        }

        function submit2() {
            $('#friend_input').removeClass('is-invalid');
            if (eval_input($("#friend_input").val())) {
                $('#friend_input').addClass('is-invalid');
                console.log('inside');
                return;
            }

            friend_inputs.push($("#friend_input").val())

            $('.node_clicked').each(function() {
                var zid = $(this).attr("id")
                checked_nodes.push(zid.substring(8))
            })

            if (iterator < 10) {
                iterator+=1;
                $('#friend_input').val("");
                $('#submit_first').show();
                $('#part2').hide();
                $('#instr2').hide();
                draw();
                return;
            }

            window.location.href = 'editor.html?id=' + userId + '&section=' + sectionId;

            //open editor, passing info via address
        }

        draw();

        /*
        $(function() {
            $("#primary_node_pic").attr("src", "img/" + subject_imgs[0][1][0][0]);
            $("#primary_caption").html(subject_imgs[0][1][0][1])
        });
        */
        function attach_listeners() {
            $(".node-button").click(function() {
                var rel_node = $(this).attr("for");
                $("#"+rel_node).toggleClass("node_clicked");
                console.log(rel_node)
            });
        }
    </script>


</html>
